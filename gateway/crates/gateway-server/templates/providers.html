{% extends "layout.html" %}

{% block content %}
{% match message %}
{% when Some with (msg) %}
<div class="bg-blue-900/50 border border-blue-700 text-blue-200 px-4 py-3 rounded mb-6">
    {{ msg }}
</div>
{% when None %}
{% endmatch %}

<!-- Add Provider Form -->
<div class="bg-dark-800 rounded-lg border border-dark-600 p-6 mb-8">
    <h3 class="text-lg font-semibold mb-4">Add Provider</h3>
    <form method="POST" action="/admin/providers/add" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-400 mb-2">Provider Name</label>
            <select name="name" required
                    class="w-full px-4 py-2 bg-dark-700 border border-dark-600 rounded-lg text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
                <option value="">Select...</option>
                <option value="openai">OpenAI</option>
                <option value="anthropic">Anthropic</option>
                <option value="azure">Azure OpenAI</option>
                <option value="google">Google AI</option>
                <option value="mistral">Mistral</option>
                <option value="groq">Groq</option>
                <option value="ollama">Ollama</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-400 mb-2">API Key</label>
            <input type="password" name="api_key" placeholder="sk-..."
                   class="w-full px-4 py-2 bg-dark-700 border border-dark-600 rounded-lg text-gray-100 placeholder-gray-500 focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-400 mb-2">API Base URL (optional)</label>
            <input type="url" name="api_base" placeholder="https://..."
                   class="w-full px-4 py-2 bg-dark-700 border border-dark-600 rounded-lg text-gray-100 placeholder-gray-500 focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>
        <div class="flex items-end">
            <button type="submit"
                    class="w-full px-4 py-2 bg-primary text-dark-900 font-semibold rounded-lg hover:bg-primary/90 transition duration-200">
                Add Provider
            </button>
        </div>
    </form>
</div>

<!-- Providers List -->
<div class="bg-dark-800 rounded-lg border border-dark-600 overflow-hidden">
    <table class="w-full">
        <thead class="bg-dark-700">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Provider</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">API Base</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Created</th>
                <th class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-dark-600" id="providers-table">
            {% for provider in providers %}
            <tr id="provider-{{ provider.id }}">
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-dark-700 flex items-center justify-center mr-3">
                            <span class="text-primary font-semibold text-sm">{{ provider.name.chars().next().unwrap_or('?') }}</span>
                        </div>
                        <span class="text-gray-100 font-medium">{{ provider.name }}</span>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                    {% match provider.api_base %}
                    {% when Some with (base) %}{{ base }}{% when None %}<span class="text-gray-500">Default</span>{% endmatch %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs rounded-full {% if provider.enabled %}bg-green-900/50 text-green-400{% else %}bg-red-900/50 text-red-400{% endif %}">
                        {% if provider.enabled %}Active{% else %}Disabled{% endif %}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                    {{ provider.created_at.format("%Y-%m-%d") }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm">
                    <button hx-post="/admin/providers/{{ provider.id }}/toggle"
                            hx-target="#provider-{{ provider.id }}"
                            hx-swap="outerHTML"
                            class="text-primary hover:text-primary/80 mr-3">
                        Toggle
                    </button>
                    <button hx-post="/admin/providers/{{ provider.id }}/delete"
                            hx-target="#provider-{{ provider.id }}"
                            hx-swap="outerHTML"
                            hx-confirm="Are you sure you want to delete this provider?"
                            class="text-red-400 hover:text-red-300">
                        Delete
                    </button>
                </td>
            </tr>
            {% endfor %}
            {% if providers.is_empty() %}
            <tr>
                <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                    No providers configured. Add one above to get started.
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}
